# AIRS Surface CH₄ Data Processing Workflow

This repository contains a set of scripts to download, process, and visualize surface-level methane (CH₄) data from the TROPESS/AIRS mission. The workflow fetches Level 2 summary data, calculates monthly averages on a defined grid, and produces a final map suitable for analysis and reports.

## Workflow Overview

The data processing is divided into three main stages:

1.  **Data Acquisition (`get_data_all.sh`)**: Downloads all `.nc` (NetCDF) data files for a specified year from the NASA GES DISC server.
2.  **Processing and Analysis (`process.py`)**: Reads the downloaded raw data, filters it for a specific month and geographical region, interpolates the CH₄ values onto a regular grid, calculates the monthly mean, and saves the output as a new NetCDF file and a PNG image.
3.  **Image Finalizing (`crop_png.sh`)**: Performs post-processing on the generated PNG map, which includes overlaying a logo and cropping the image to a final layout.

## Prerequisites

Before running the scripts, ensure you have the following dependencies installed and configured.

### Software
* **A Unix-like environment** (Linux, macOS, or WSL on Windows)
* **`wget`**: For downloading the data.
* **Python 3**: For data processing.
* **ImageMagick**: For image manipulation (`composite`, `convert`).

### Authentication
* **NASA Earthdata Account**: You need an account to download the data. You can register at [URS Earthdata](https://urs.earthdata.nasa.gov/users/new).
* **`.netrc` file**: Create a file named `.netrc` in your home directory (`~/.netrc`) with the following content to enable passwordless downloads:
    ```
    machine urs.earthdata.nasa.gov
    login YOUR_USERNAME
    password YOUR_PASSWORD
    ```
* **`.urs_cookies` file**: The `get_data_all.sh` script will generate this file automatically upon the first run to maintain your session.

### Python Libraries
You can install the required Python libraries using `pip`:
```bash
pip install xarray numpy matplotlib scipy pandas
```

### Usage Instructions
#### Step 1: Download Data
The ```get_data_all.sh``` script downloads all available CH₄ data for a given year.

1. Configure: Open ```code/get_data_all.sh``` and set the YEAR variable to your year of interest.
   ```bash
   # === USER INPUT ===
   YEAR=2025
   ```
2. Execute: Run the script from the repository's root directory.
   ```bash
   bash code/get_data_all.sh
   ```
   The script will create a ```1-data/``` directory and download the files there. This process may take a significant amount of time depending on the data volume.

#### Step 2: Process Data and Generate Map
The ```process.py``` script processes the downloaded files to generate a monthly average.

1. Configure: Open code/process.py and set the year and month variables. You can also adjust the geographical lat_min, lat_max, lon_min, lon_max, and grid resolution grid_res if needed.
   ```Python
   # === USER INPUT: SET YEAR AND MONTH ===
   year = "2025"
   month = "02" # Make sure month is two digits
   
2. Execute: Run the script from the repository's root directory.
```Python
python3 code/process.py
```
3. Outputs: The script will produce two files in the root directory:
   - ```ch4_surface_YYYYMM.nc```: A NetCDF file containing the gridded monthly mean data.
   - ```ch4_surface_YYYYMM.png```: A map visualizing the monthly mean CH₄ concentration.

#### Step 3: Finalize the Image
The ```crop_png.sh``` script customizes the generated PNG image.

1. Prepare: Make sure you have a logo file named logo_bmkg.png in the root directory.
2. Configure: This step is critical. The script contains hardcoded filenames. You must edit code/crop_png.sh to match the output from process.py. For example, for February 2025, you would change monthly_idn_1.png to ch4_surface_202502.png.
   ```Bash
   #!/bin/bash
   # Change this line to the name of the file generated by process.py
   mv ch4_surface_202502.png oco2_co2mx_idn_01.png
   # ... rest of the script ...
3. Execute: Run the script from the root directory.
   ```Bash
   bash code/crop_png.sh
   ```
This will create a final, cropped image named ```airs_ch4mx_idn_01.png```.

###Script Descriptions
- ```code/get_data_all.sh```: Downloads all .nc files for a specified year from the TROPESS data server using wget.
- ```code/process.py```: A Python script that reads the downloaded NetCDF files for a given month, performs interpolation and averaging, and saves the results as a gridded NetCDF file and a PNG map.
- ```code/crop_png.sh```: A shell script that uses ImageMagick to overlay a logo and crop the generated PNG map for final presentation.

![](https://github.com/alberthnahas/airs-ch4/blob/main/ch4-indonesia.gif)
